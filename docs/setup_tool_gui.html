<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LKG-Uff-Cross Setup Tool</title>
    <link rel="stylesheet" href="waterize_dark.css">
</head>
<body>
<h2>Welcome to the setup tool!</h2>
<p>
    This page will guide you through the creation of a configuration file to customize your installation of the cross project.
    This page will create configurations for the Current Beta Version as of 18 Nov 2020.
</p>
<p>
    pins: https://content.instructables.com/ORIG/F14/JLPV/JQGYDSLJ/F14JLPVJQGYDSLJ.png
    The DMX Serial Input Pin is pin 16 (to change use another UART2 RX enabled pin and edit dmx.cpp:3
    Assumes the Start is somewhere on the left side of the lower arm going counter-clockwise around the cross (from the front)

    After you've downloaded the file, put it next to esp_32_dmx_sk.ino file
</p>
<form id="config_form">
    <label>Basics:</label>
    <label>How do you want to Address the Fixture?</label>
    <div class="toggle">DMX Procedure and Two Buttons are explained in the manual</div>
    <input type="radio" id="in_field_none" name="USE_INFIELD_ADDRESSING" value="0" checked>
    <label for="in_field_none">Static Address</label><br/>
    <input type="radio" id="in_field_dmx" name="USE_INFIELD_ADDRESSING" value="1">
    <label for="in_field_dmx">DMX Procedure</label><br/>
    <input type="radio" id="in_field_btns" name="USE_INFIELD_ADDRESSING" value="2">
    <label for="in_field_btns">Two Buttons</label><br/>
    <input type="radio" id="in_field_dips" name="USE_INFIELD_ADDRESSING" value="3">
    <label for="in_field_dips">Dip Switches</label><br/>

    <div class="conditional" data-r-id="USE_INFIELD_ADDRESSING" data-r-value="0" data-r-operation="">
    <label for="DMX_START_ADDRESS">Default DMX Address of the first channel (1 indexed):</label>
    <div class="toggle">If you want to change the Address In-Field you can use any value here.
        <br/>Addresses beyond 480 aren't correctly interpreted by the used break-detection.</div>
    <input type="number" id="DMX_START_ADDRESS" name="DMX_START_ADDRESS" min="1" max="472" value="1">
    </div>

    <label for="LED_PIN">Select the Output Pin:</label>
    <div class="toggle">By GPIO number:
        <a href="https://content.instructables.com/ORIG/F14/JLPV/JQGYDSLJ/F14JLPVJQGYDSLJ.png">Pin Layout Reference</a></div>
    <input type="number" id="LED_PIN" name="LED_PIN" min="1" max="39" value="4">

    <label for="T_DEADZONE_SIZE">How large should the Deadzone on the Time-Slider be:</label>
    <input type="range" id="T_DEADZONE_SIZE" name="T_DEADZONE_SIZE" min="1" max="50" value="5">

    <label>Shape</label>

    <label for="SHds">down</label>
    <input type="number" id="SHds" name="SHds" min="0" value="6">
    <label for="SHls">left</label>
    <input type="number" id="SHls" name="SHls" min="0" value="3">
    <label for="SHts">top</label>
    <input type="number" id="SHts" name="SHts" min="0" value="2">
    <label for="SHrs">right</label>
    <input type="number" id="SHrs" name="SHrs" min="0" value="3">
    <label for="SHos">out</label>
    <input type="number" id="SHos" name="SHos" min="0" value="2">
    <label for="SH_off">Offset</label>
    <input type="number" id="SH_off" name="SH_off" min="0" value="0">


    <!--<label>Advanced</label>-->


    <input type="submit" value="Generate & Download!">
</form>
<script src="FileSaver.js"></script>
<script>
    function getAsInt(fData, key) {return Number.parseInt(fData.get(key));}
    document.querySelector('form#config_form').addEventListener('submit', e => {
        const fdata = new FormData(e.target);
        e.preventDefault();

        let LED_COUNT =
            2 * (getAsInt(fdata, "SHds")
                 + getAsInt(fdata, "SHls")
                 + getAsInt(fdata, "SHrs")
                 + getAsInt(fdata, "SHts"))
            + 4 * getAsInt(fdata, "SHos");
        let template =
`
#ifndef PRE_CPP
#define PRE_CPP 1

#define DMX_START_ADDRESS ${fdata.get("DMX_START_ADDRESS")}
#define USE_INFIELD_ADDRESSING ${fdata.get("USE_INFIELD_ADDRESSING")}
#define LED_COUNT ${LED_COUNT}
#define LED_PIN ${fdata.get("LED_PIN")}

#define T_DEADZONE_SIZE ${fdata.get("T_DEADZONE_SIZE")}

#define SHds ${fdata.get("SHds")}
#define SHls ${fdata.get("SHls")}
#define SHts ${fdata.get("SHts")}
#define SHrs ${fdata.get("SHrs")}
#define SHos ${fdata.get("SHos")}
#define SH_off ${fdata.get("SH_off")}

#define POLLRATE 30
#define UPDATETIME 10
#define T_MAX (LED_COUNT * 64)
#define COLOR_SLOT_COUNT 4

#define DEBUG 1

#endif
`;
        console.info(template);
        let blob = new Blob([template], {type: "text/x-c;charset=utf-8"});
        saveAs(blob, "preferences.cpp");
    });
</script>
</body>
</html>